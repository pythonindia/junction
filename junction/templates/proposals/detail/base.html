{% extends 'base.html' %}
{% load bootstrap3 %}
{% load django_markdown %}
{% load static %}

{% block head_title %} Proposal Details | {{ block.super }} {% endblock %}

{% block endhead %}
<style>
  .required > label:after {
    content: "*";
  }
</style>
<script>
    $(document).ready(function() {
        $("form.ajax").submit(function(e){
            e.preventDefault();
            var $this = $(this);
            var url = $this.attr('action');
            var method = $this.attr('method');
            var data = $this.serialize();
            jQuery.ajax({
                type : method,
                url : url,
                dataType : 'json',
                data : data,
                success : function(data){
                    alert("Success:" + data['get_votes_count'] + "This data should display in the right position.");
                    // The 'data['get_votes_count']' value should be replaced with '[{{comment.get_votes_count}}]'. 
                },
                error : function(data){
                    console.log(data);
                    alert("Error");
                }
            });
        });
    }); 
</script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-sm-6 col-sm-offset-3 col-xs-12 col-xs-offset-0 push-3">
        <div class="form-container space-2-bottom">
            <h2 class="fill-blue text-center">Proposal Details</h2>
            <div class="pad-2 push-half-top push-2-bottom">
              <hr>
                    <table>
                        <tr>
                            <td>
                                Title
                            </td>
                            <td class="text-center">
                                {{ proposal.title }}

                                {% if user.is_authenticated %}
                                    <{{ vote_value }}> <!-- (0) - not voted, (-1) - downvote, (1) - up vote  -->
                                      <form method="POST" action="{{ proposal.get_up_vote_url }}">
                                            {% csrf_token %} {{ proposal_vote_form }}
                                            <button type="submit" class="btn btn-primary"> Up Vote </button>
                                      </form>
                                {% endif %}

                                [{{ proposal.get_votes_count }}]

                                {% if user.is_authenticated %}
                                   <form method="POST" action="{{ proposal.get_down_vote_url }}">
                                        {% csrf_token %} {{ proposal_vote_form }}
                                        <button type="submit" class="btn btn-primary"> Down Vote </button>
                                  </form>
                                {% endif %}

                            </td>
                        </tr>
                        <tr>
                            <td>
                                Description
                            </td>
                            <td class="text-center">
                                {{ proposal.description|markdown }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Target Audience
                            </td>
                            <td class="text-center">
                                {% if proposal.target_audience == 1 %}
                                    Beginner
                                {% elif proposal.target_audience == 2 %}
                                    Intermediate
                                {% else %}
                                    Advanced
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Prerequisites
                            </td>
                            <td class="text-center">
                                {{ proposal.prerequisites|markdown }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Content URLS
                            </td>
                            <td class="text-center">
                                {{ proposal.content_urls|markdown }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Speaker Info
                            </td>
                            <td class="text-center">
                                {{ proposal.speaker_info|markdown }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Speaker Links
                            </td>
                            <td class="text-center">
                                {{ proposal.speaker_links|markdown }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Status
                            </td>
                            <td class="text-center">
                                {% if proposal.status == 1 %}
                                    Draft
                                {% elif proposal.status == 2 %}
                                    Public
                                {% else %}
                                    Cancelled
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Proposal Type
                            </td>
                            <td class="text-center">
                                {{ proposal.proposal_type }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Proposal Section
                            </td>
                            <td class="text-center">
                                {{ proposal.proposal_section }}
                            </td>
                        </tr>
                    </table>

<<<<<<< HEAD:junction/templates/proposals/detail.html
=======
<div class="custom-container">
<div class="proposal-details">
    <div class="row proposal-title">
        <div class="col-sm-11">
            <h1>
                {{ proposal.title }}
            </h1>
            <span>
            by:
            <b>
            {{ proposal.author.get_full_name }}
            </b>
            </span>
            {% if can_delete %}
            <div class="proposal-update">
                <a href="{{ proposal.get_update_url }}" >
                <i class="fa fa-pencil-square-o"> </i>
                </a>
                <a href="{{ proposal.get_delete_url }}" >
                <i class="fa fa-trash-o"> </i>
                </a>
                <a href="{{ proposal.get_absolute_url }}#comments" >
                <i class="fa fa-comments-o"> </i>
                </a>
                <a href="{{ proposal.get_absolute_url }}reviewers/#comments" >
                <i class="fa fa-info"> </i>
                </a>
            </div>
            {% endif %}
        </div>
        {% if user.is_authenticated %}
        <div class="col-sm-1">
            <div class="icon-holder  pull-right text-center">
                <div>
                    <h4>
                        {{ vote_value }}
                    </h4>
                </div>
                <div class="icon-holder-bottom">
                    <i class="fa fa-thumbs-down prosal-down-vote">
                    </i>
                    <i class="fa fa-thumbs-up prosal-up-vote">
                    </i>
                </div>
            </div>
            <form id="prosal-up-vote" method="POST" action="{{ proposal.get_up_vote_url }}">
                {% csrf_token %} {{ proposal_vote_form }}
            </form>
            <form id="prosal-down-vote" method="POST" action="{{ proposal.get_down_vote_url }}">
                {% csrf_token %} {{ proposal_vote_form }}
            </form>
        </div>
        {% endif %}
    </div>
    <div class="row porsal-title-section">
        <div class="col-sm-12 fill-blue ">
            <div class="col-xs-12 col-sm-8 padding-less ">
                <b>
                Section :
                </b>
                {{ proposal.proposal_section }}
                <br>
                <b>
                Type :
                </b>
                {{ proposal.proposal_type }}
            </div>
            <div class="col-xs-12 col-sm-4 padding-less ">
                <b>
                Status :
                </b>
                {% if proposal.status == 1 %}
                    Draft
                {% elif proposal.status == 2 %}
                    Public
                {% else %}
                    Cancelled
                {% endif %}
>>>>>>> 70c634d0a62742f0988cb9c21681fc76803d5cad:junction/templates/proposals/detail/base.html
                <br>
                {% if can_delete %}
                    <button onclick="location.href='{{ proposal.get_update_url }}'">Edit</button>
                    <button onclick="location.href='{{ proposal.get_delete_url }}'">Delete</button>
                {% endif %}
            </div>

        </div>
    </div>

</div>

<<<<<<< HEAD:junction/templates/proposals/detail.html
<div id="comments">

    {% if not comments %}
        <p> No comments added so far. </p>
    {% endif %}

    {% for comment in comments %}
        <p>
            {{ comment.created_at }}, {{ comment.commenter }}, {{ comment.private }}
            <br/>
            {% if user.is_authenticated %}
                  <form class="ajax" method="POST" action="{{ comment.get_up_vote_url }}">
                        {% csrf_token %} {{ proposal_comment_vote_form }}
                        <button type="submit" class="btn btn-primary"> Up Vote </button>
                  </form>
            {% endif %}
            [{{ comment.get_votes_count }}]
            {% if user.is_authenticated %}
               <form class="ajax" method="POST" action="{{ comment.get_down_vote_url }}">
                    {% csrf_token %} {{ proposal_comment_vote_form }}
                    <button type="submit" class="btn btn-primary"> Down Vote </button>
              </form>
            {% endif %}
                                
            {{ comment.comment|markdown }}
        </p>
    {% endfor %}

    {% if user.is_authenticated %}
          <form method="POST" action="{% url 'proposal-comment-create' proposal.conference.slug proposal.slug %}"> {% csrf_token %}
            {{ proposal_comment_form.media }}
            {% bootstrap_field proposal_comment_form.comment %}

            {% if allow_private_comment %}
                {% bootstrap_field proposal_comment_form.private %}
            {% endif %}
=======
            {% if proposal.speaker_links %}
                <h4>
                    Speaker Links :
                </h4>
                <p>
                    {{ proposal.speaker_links|markdown }}
                </p>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12" id="comments">
          {% block comments %}
          {% endblock %}
        </div>
    </div>
</div>

>>>>>>> 70c634d0a62742f0988cb9c21681fc76803d5cad:junction/templates/proposals/detail/base.html

            {% buttons %}
                <button type="submit" class="btn btn-primary">
                    Add Comment
                </button>
            {% endbuttons %}
          </form>
    {% else %}
        <p> <a href="{% url 'account_login' %}">Login </a> to add a new comment. </p>
    {% endif %}

</div>

{% endblock %}
